---
TASK: '4'
Author: Shreya Khare
---
# SHREYA KHARE


# TASK 4

#importing libraries
```{r}
library(plyr)   # for rename, revalue
```

# read the raw input
```{r}
dat <- read.csv("globalterrorism.csv", header = TRUE, na.strings = c("", "."))
```

```{r}
# sanity check that import was ok (there should be ~105k rows and 123 columns)
dim(dat)
```
#There are 137 columns in the dataset, to make it neat, I will have to do some subsetting, only keep the columns I need.
```{r}
terrorism <- dat[,c("iyear","imonth", "iday", "country_txt", "region_txt", "provstate", "city", "latitude", "longitude", "attacktype1_txt", "targtype1_txt", "corp1", "target1", "natlty1_txt", "gname", "weaptype1_txt", "weapsubtype1_txt")]
```

#Terrorist Attack Trends
```{r}
library(ggplot2)
library(dplyr)
library(ggthemes)
by_year <- terrorism %>% group_by(iyear) %>% 
  summarise(n=n())
ggplot(aes(x = iyear, y = n), data = by_year) +
        geom_line(size = 2.5, alpha = 0.7, color = "mediumseagreen") +
        geom_point(size = 0.5) + xlab("Year") + ylab("Number of terrorist Attacks") +
        ggtitle("Terrorist Attacks Worldwide by Year 1970-2017") + theme_fivethirtyeight()
```
#Globally, terrorist attacks have increased dramatically since 2010

```{r}
by_region <- terrorism %>% group_by(region_txt, iyear) %>% 
  summarise(n=n())
ggplot(by_region, aes(x = iyear, y = n, colour = region_txt)) + 
  geom_line() +
  geom_point() +
  facet_wrap(~region_txt) + xlab('Year') +
  ggtitle('Terrorist Attacks by Region and Year 1970-2017') + 
  theme(legend.position="none")

```

#Central America was very unstable starting from the late 1970’s, it got better with time, and it has been stablized since around 1995.

#Western Europe had a rough past, experienced many attacks until early 2000s.

#South America had the similar pattern, was very dangerous since early 1980 until just before 2000.

#Middle East, North Africa and South Asia had a relative quiet past unitl around 1980, the terrorist attacks in those regions had a steady increase from 1980s to around 2005, and had surged dramatically since then.

```{r}
by_region_no_year <- terrorism %>% group_by(region_txt) %>% 
  summarise(n=n())
ggplot(aes(x=reorder(region_txt, n), y=n), data=by_region_no_year) +
  geom_bar(stat = 'identity') +
  ggtitle('Terrorist Attacks by Region 1970-2017') + coord_flip() + theme_fivethirtyeight()
```

#A small fraction of the terrorist attacks happened in the Western countries. Most attacks were heavily concentrated geographically in Middle East, North Africa and South Asia.

#Let’s look at the countries.
```{r}
by_country <- terrorism %>% group_by(country_txt) %>% 
  summarise(n=n())
by_country <- arrange(by_country, desc(n))
top10 <- head(by_country, 10)
top10
ggplot(aes(x=reorder(country_txt, n), y=n), data=top10) + 
  geom_bar(stat = 'identity') + xlab('Country') + ylab('Number of Terrorist Attacks') + ggtitle('Countries with the most terrorist attacks, 1970-2017') +
  coord_flip() + theme_fivethirtyeight()
```

#Iraq, Afghanistan and pakistan, India have suffered the most from terrorism. Surprisingly, United Kingdom tops the list in Europe, with almost 5000 attackes from 1970 to 2017.


#Tactics and Weapons
```{r}
by_attacktype <- terrorism %>% group_by(attacktype1_txt) %>% 
  summarise(n=n())
ggplot(aes(x=reorder(attacktype1_txt, n), y=n), data=by_attacktype) + 
  geom_bar(stat = 'identity') + xlab('Attack Type') + ylab('Number of Attacks') + ggtitle('Terrorist Attack Tactics Wordwide, 1970-2017') + coord_flip() +
  theme_fivethirtyeight()
```

```{r}
by_weapon <- terrorism %>% group_by(weaptype1_txt) %>% 
  summarise(n=n())
ggplot(aes(x=reorder(weaptype1_txt, n), y=n), data=by_weapon) + 
  geom_bar(stat = 'identity') + xlab('Weapon') + ylab('Number of Attacks') + ggtitle('Terrorist Attack By Weapon Wordwide, 1970-2017') + coord_flip() +
  theme_fivethirtyeight()
```
#The most commonly used attack tactic from 1970 to 2017 involved bomb and explosives, followed by armed assault.

#Who are they targeting?

```{r}
attack2017 <- terrorism[terrorism$iyear==2017, ]
by_target <- attack2017 %>% group_by(targtype1_txt) %>% 
  summarise(n=n())
by_target <- arrange(by_target, desc(n))
by_target
ggplot(aes(x=reorder(targtype1_txt, n), y=n), data=by_target) +
  geom_bar(stat = 'identity') + ggtitle('Terrorist Attack Targets/Victims, 2017') +
  coord_flip() + theme_fivethirtyeight()
```

#Which countries/cities were the most dangerous in 2017?

```{r}
attack2017_by_city <- attack2017 %>% group_by(country_txt, city) %>% 
  summarise(n=n())
attack2017_by_city <- arrange(attack2017_by_city, desc(n))
top10_city_2017 <- head(attack2017_by_city, 20)
top10_city_2017
```

```{r}
baghdad <- terrorism[terrorism$city=='Baghdad', ]
baghdad_year <- baghdad %>% group_by(iyear) %>% 
  summarise(n=n())
ggplot(aes(x = iyear, y = n), data = baghdad_year) +
        geom_line(size = 2.5, alpha = 0.7, color = "mediumseagreen") +
        geom_point(size = 0.5) + xlab("Year") + ylab("Number of terrorist Attacks") +
        ggtitle("Terrorist Attacks in Baghdad by Year 1970-2015") + theme_fivethirtyeight()
```

```{r}
baghdad_type <- baghdad %>% group_by(attacktype1_txt, iyear) %>% 
  summarise(n=n())
ggplot(aes(x=iyear, y=n, fill=attacktype1_txt), data=baghdad_type) + 
  geom_bar(stat = 'identity') +
  ggtitle('Attack Type in Baghdad') + theme_fivethirtyeight()
```

#Baghdad once was a prestigious learning and cultural center. Since the coalition invasion in 2003, it has become one of the most dangerous cities on Earth.

#A heatmap of terrorist attack deaths worldwide 2017
```{r}

gtd <- read.csv("globalterrorism.csv")
gtd2017 <- gtd[gtd$iyear==2017, ]
gtd2017 <- aggregate(nkill~country_txt,gtd2017,sum)
library(rworldmap)
gtdMap <- joinCountryData2Map( gtd2017, 
                               nameJoinColumn="country_txt", 
                               joinCode="NAME" )

mapDevice('x11')
mapCountryData( gtdMap, 
                nameColumnToPlot='nkill', 
                catMethod='fixedWidth', 
                numCats=100 )
```